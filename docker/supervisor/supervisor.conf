[supervisord]
nodaemon=true
user=root
logfile=/dev/fd/1
logfile_maxbytes=0
logfile_backups=0
loglevel=info

[program:haproxy]
command=/usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg
autostart=true
autorestart=true
startsecs=0
priority=50
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
redirect_stderr=true

[program:nodejs]
command=npx nodemon --watch /usr/src/app/dist --ext js --exec "NODE_ENV=production node dist/server.js"
directory=/usr/src/app
user=root
autostart=true
autorestart=true
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
redirect_stderr=true
priority=200
startretries=3
stopwaitsecs=10
